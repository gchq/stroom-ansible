---

- name: 'Check mandatory variables are defined'
  assert:
    that:
      - local_config_dir is defined
      - stroom_install_root_dir is defined
      - stroom_version is defined
      - stroom_user is defined

- import_role:
    name: non_docker_stroom/download
  tags:
    - deploy

- import_role:
    name: non_docker_stroom/update_config
  tags:
    - deploy
    - configure

- import_role:
    name: non_docker_stroom/systemd
  tags:
    - deploy

- name: 'Create admin user'
  when: stroom_initial_admin_user is defined
  run_once: true
  command: "{{ java_info[java_version].java_home_dir }}/bin/java -jar {{ stroom_home_dir }}/bin/stroom-app-all.jar manage_users --createUser {{ stroom_initial_admin_user }} --createGroup Administrators --addToGroup {{ stroom_initial_admin_user }} Administrators --grantPermission Administrators Administrator {{ stroom_home_dir }}/config/config.yml"
